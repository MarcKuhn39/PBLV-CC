<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cafeteria Counter HM</title>
    <!-- Bootstrap Integration -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>

    <!-- Material Light Integration -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    <link rel="stylesheet" href="https://code.getmdl.io/1.3.0/material.indigo-pink.min.css">
    <script defer src="https://code.getmdl.io/1.3.0/material.min.js"></script>

    <!-- integrating style.css (for background)-->
    <link rel="stylesheet" href="assets/css/style.css">
    <link rel="stylesheet" href="assets/css/thermometer.css">

</head>

<body style="font-size:25px;">
     <!-- This is the Heading Line -->
     <div style="text-align: center;">
        <h1 class="white-text">
            Cafeteria Counter
            <small>der Hochschule M체nchen</small>
        </h1>
     </div>

     <!-- This is the Container -->
     <div class="container">
        <div class="row g-5 row-cols-1 row-cols-md-2">

        <!-- This is the left card -->
            <div class="card shadow-sm">

                <!-- This is the title -->
                <h2 class="card-title">Mensa Auslastung</h2>

                <!-- This is the thermometer -->
                <section class="container">
                    <div class="logo">
                        <div class="bar" style="--thermometer-value: 200px;">
                            <div class="circle"></div>
                        </div>
                    </div>
                </section> <br>

                <!-- This is the counter for available Seats -->
                <div id="seats-free"></div>
                  <script>
                    fetch("http://localhost:5000/full")
                        .then(response => response.json())
                        .then(data => {
                            let currentVisitorCount = data.currentVisitorCount;
                            document.getElementById("seats-free").innerHTML = `Pl채tze verf체gbar: ${500 - currentVisitorCount}`;
                        })
                        .catch(error => console.log(error));
                  </script>

                  <br>

                <!-- This is the estimated waiting time -->

                    <img class= "clock-downsizer" src="assets/img/blackclock.png" width="120" height= "auto"> <br>
                        <div id="queue-time" class="center">></div>
                        <script>
                          fetch("http://localhost:5000/full")
                              .then(response => response.json())
                              .then(data => {
                                  let queueTime = data.estimatedQueueTimeInMin;
                                  document.getElementById("queue-time").innerHTML = `Vorraussichtliche Wartezeit: ${queueTime} minuten`;
                              })
                              .catch(error => console.log(error));
                        </script>
                        <style>
                          #queue-time {
                            text-align: center;
                          }
                          </style> <br>
                      <button onclick="fetchData()"> Fetch Now</button>
            </div>


            
        <!-- This is the right card -->
            <div class="card shadow-sm">

                <!-- This is the first title -->
                <h2 class="card-title">St체ndlicher Besuch</h2>

                <!-- This is the daily chart in chartjs-->
                <div>
                    <canvas id="myDailyChart" width="400", height="250"></canvas>
                </div>

                <!-- This is the second title -->
                <h2 class="card-title">Wochenverlauf</h2>

                <!-- This is the weekly chart -->
                    <div>
                        <canvas id="myWeekChart" width="400", height="250"></canvas>
                    </div>
            </div>
        </div>
    </div>


<!-------------------------------------------- This section contains the Javascript Part ---------------------------------------------------->
      
      <!-- integrate chartJS -->
      <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

      <!-- test code shows how you can fetch the currentVisitorCount from the API -->
      <script>
      fetch("http://localhost:5000/full")
        .then(response => {
          if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
          }
          return response.json();
        })
        .then(data => {
          const currentVisitorCount = data.currentVisitorCount;
          console.log(currentVisitorCount);
        })
        .catch(error => console.log("Error: ", error));
      </script>

      <script>
        async function fetchData() {
          const url= 'http://localhost:5000/full';
          const response = await fetch(url);
          // wait until the request has been completed
          const datapoints = await response.json();
          console.log("here is how to fetch data" + datapoints);
          return datapoints;
        }
      </script>

      fetchData().then(datapoints => {
        const = month = datapoints.maxStatPerHour
      })

      <!-- this is the code for the daily chart -->
      <script>
        let customData = []

          fetch("http://localhost:5000/full")
                  .then(response => {
                    if (!response.ok) {
                      throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                  })
                  .then(data => {
                    // Here you can see how to fetch day data
                    const t1 = data.stats.maxPerHourStat[0].count;
                    console.log("Max Stat on 1.00 PM was: " + t1);
                    customData.push(t1)
                    console.log("customData[0] is: " + customData[0]);
                    const t2 = data.stats.maxPerHourStat[1].count;
                    console.log("Max Stat on 1.30 PM was: " + t2);
                    customData.push(t2)
                    console.log("customData[0] is: " + customData[1]);
                    const t3 = data.stats.maxPerHourStat[2].count;
                    console.log("Max Stat on 1.00 PM was: " + t3);
                    customData.push(t3)
                    console.log("customData[0] is: " + customData[2]);
                    const t4 = data.stats.maxPerHourStat[3].count;
                    console.log("Max Stat on 1.30 PM was: " + t4);
                    customData.push(t4)
                    console.log("customData[1] is: " + customData[3]);
                    const t5 = data.stats.maxPerHourStat[4].count;
                    console.log("Max Stat on 1.00 PM was: " + t5);
                    customData.push(t5)
                    console.log("customData[0] is: " + customData[4]);
                    const t6 = data.stats.maxPerHourStat[5].count;
                    console.log("Max Stat on 1.30 PM was: " + t6);
                    customData.push(t6)
                    console.log("customData[0] is: " + customData[5]);
                    const t7 = data.stats.maxPerHourStat[6].count;
                    console.log("Max Stat on 1.00 PM was: " + t7);
                    customData.push(t7)
                    console.log("customData[0] is: " + customData[6]);
                    
                    // Create the chart

                    const ctxdaily = document.getElementById('myDailyChart');
                    
                    new Chart(ctxdaily, {
                      type: 'line',
                      data: {
                        labels: ['11 Uhr', '11.30 Uhr', '12 Uhr' , '12.30 Uhr', '13 Uhr', '11.30 Uhr', '14 Uhr'],
                        datasets: [{
                          label: '# Amount of Visitors',
                          data: customData,
                          backgroundColor: [
                            'rgba(255, 99, 132, 0.7)',
                            'rgba(54, 162, 235, 0.7)',
                            'rgba(255, 206, 86, 0.7)',
                            'rgba(75, 192, 192, 0.7)',
                            'rgba(255, 102, 255, 0.7)',
                            'rgba(100, 232, 145, 0.7)',
                            'rgba(255, 162, 75, 0.7)'
                          ],
                          borderColor: [
                          'rgba(255, 99, 132, 0.9)',
                            'rgba(54, 162, 235, 0.9)',
                            'rgba(255, 206, 86, 0.9)',
                            'rgba(75, 192, 192, 0.9)',
                            'rgba(255, 102, 255, 0.9)',
                            'rgba(100, 232, 145, 0.7)'
                          ],
                          borderWidth: 1
                        }]
                      },
                      options: {
                        scales: {
                          y: {
                            beginAtZero: true
                          }
                        }
                      }
                    });
                  })
                  .catch(error => console.log("Error: ", error));




      </script>
      
      <!-- this is the code for the week chart -->
      <script>
          fetch("http://localhost:5000/full")
                  .then(response => {
                    if (!response.ok) {
                      throw new Error(`HTTP error! status: ${response.status}`);
                    }
                    return response.json();
                  })
                  .then(data => {
                    // Here you can see how to fetch day data
                    const mondayValue = data.stats.maxPerHourStat[0].count;
                    console.log("Max stat on monday was: " + mondayValue);
                  })
                  .catch(error => console.log("Error: ", error));

        const ctx = document.getElementById('myWeekChart');
      
        new Chart(ctx, {
          type: 'bar',
          data: {
            labels: ['Monday', 'Tuesday', 'Wednesday', 'Thursday', 'Friday'],
            datasets: [{
              label: '# Peak Value',
              data: [2, 2, 321, 69, 39],
              backgroundColor: [
                'rgba(255, 99, 132, 0.7)',
                'rgba(54, 162, 235, 0.7)',
                'rgba(255, 206, 86, 0.7)',
                'rgba(75, 192, 192, 0.7)',
                'rgba(255, 102, 255, 0.7)',
                'rgba(100, 232, 145, 0.7)'
              ],
              borderColor: [
              'rgba(255, 99, 132, 0.9)',
                'rgba(54, 162, 235, 0.9)',
                'rgba(255, 206, 86, 0.9)',
                'rgba(75, 192, 192, 0.9)',
                'rgba(255, 102, 255, 0.9)',
                'rgba(100, 232, 145, 0.7)'
              ],
              borderWidth: 1
            }]
          },
          options: {
            scales: {
              y: {
                beginAtZero: true
              }
            }
          }
        });
      </script>


            
</body>
</html>